{% extends '/admin/base.html.twig' %}

{% block breadcumbs %}
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ path('admin') }}">Article</a></li>
        <li class="breadcrumb-item active" aria-current="page">Liste</li>
    </ol>
{% endblock %}
{% block content %}
    <div class="mb-2">
        <a class="btn btn-primary add-button" href="{{ path('form_article') }}">
            <i class="fa fa-plus me-2" aria-hidden="true"></i>Ajouter
        </a>
    </div>
     <div class="row align-items-center justify-content-start">
        {% for article in articles %}
            <div class="card m-2" style="width:30%;height: 460px" >
                <div class="card-body">
                    <h5 class="card-title">{{ article.title }}</h5>
                    {% if article.author %}
                    <span style="font-size:13px">{{ article.author.user.name }}</span>
                    {% else %}
                        <span style="font-size:13px">Non renseigné</span>
                    {% endif %}
                    {% if article.thumbnail %}
                        <img class="img-fluid" style="width:100%;" src={{"http://localhost:8080/uploads/"~ article.thumbnail}} alt="{{ article.title }}" />
                    {% else %}
                        <img class="img-fluid" style="width:100%;" src={{"http://localhost:8080/img/thumbnail.png"}} alt="{{ article.title }}" />
                    {% endif %}
                    <div class="card-paragraph mb-4 mt-2">
                    {{ article.extract | raw }}
                    </div>
                    <div class=fixed-bottom">
                    <a href="{{ path('detail_article', {id: article.id}) }}" class="edit">Voir plus</a>
                    {% if is_granted('ROLE_ADMIN') or article.author.user == app.user %}
                        <a style=" cursor: pointer" id-article="{{article.id}}" class="deleteLink"  url="{{ path('delete_article') }}" ><span class="material-icons-outlined edit float-end" id="password-edit" >delete_outline</span></a>
                        <a href="{{ path('form_article', {id: article.id}) }}"><span class="material-icons-outlined edit float-end" id="password-edit" >edit</span></a>
                    {% endif %}
                    </div>
                </div>
            </div>
        {% endfor %}
     </div>
{% endblock %}
    {% block modal %}
<!-- Modal -->
<div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-body text-center">
          <p> Etes-vous sûr de vouloir supprimer cet article?</p>
          <input type="hidden" id="url" value='' />
          <input type="hidden" id="id" value='' />
          <button type="button" class="btn btn-link blue-button" data-mdb-dismiss="modal">Annuler</button>
          <button type="button" id="deleteBtn" class="btn btn-link blue-button">
                  Valider
          </button>
      </div>
    </div>
  </div>
</div>
    {% endblock %}

{% block documentReady %}
    <script>
        $(document).ready(function() {
            $('.deleteLink').click(function () {
                $('#url').val($(this).attr('url'));
                $('#id').val($(this).attr('id-article'));
                $('#modal').modal('show');
            });

            $('#deleteBtn').click(function (e) {
                e.preventDefault();
                let url = $('#url').val();
                let id = $('#id').val();

                $(this).prop("disabled", true);
                $(this).html(
                    `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> En cours...`
                );

                $.post(url, {id: id}, function (data) {
                    $('#modal').modal('toggle');
                    if (data.res === 1) {
                        $("#" + id).remove();
                    } else {
                        alert("Une erreur est survenue");
                    }
                });
            });
        });
    </script>
{% endblock %}